---
title: "Simulate from maximum likelihood parameter estimates"
author: Sylvia Ranjeva
date: May 6, 2020
output: html_document
---
Code to simulate interventions based on scaling of post-intervention beta beginning 5/1/2020 at increases of 20, 40, and 60% transmission rate. 

First, set up the code and specify the parameters for the forecasting:
```{r}
require(dplyr)
require(pomp)
require(ggplot2)
require(magrittr)
require(lubridate)
require(MASS)
require(reshape2)
require(dplyr)
require(cowplot)
require(scales)
require(MMWRweek)
require(rmutil)

select <- dplyr::select
rename <- dplyr::rename
summarize <- dplyr::summarise
contains <- dplyr::contains

root <- '../'
source(file.path(root, '_covid_root.R'))

covid_set_root(root)

input_points_file ="consolidated.all.sample_from_surface.revised2.csv"
source("input_file_specification.R") # script to read in necessary files

# Projection specifications: all projections
reference_date <- as.Date("2020-01-14") # All numeric times in reference to this date 
end_projection_date <- as.Date("2020-6-10")
start_projection_date <- as.Date("2020-03-01")
deltaT = 0.1 # timestep for projections 
n_regions = 3 

# Specify scenarios regarding relaxation of interventions 
scales = c(1, 1.2, 1.4, 1.6) # Scenarios for scaling of post-intervention beta
beta_noise_amplitude = 0.05 # amplitude for noise when scaling post-intervention beta 
intervention_lift_date <- as.Date("2021-10-15") # this is the date at which any relaxation of intervention begins
today = as.Date(Sys.Date()) # define today for adding noise to forward post-intervention transmission 

regional_aggregation = T # If true, do statewide estimates

```

Next, generate the simulation results as a .csv file
```{r}
# Output filepath 
output_path = "./sim_projections/"

# Run the simulation
source("inference_to_simulation.R")

```

Now, make the relevant plots 
```{r}
output_path = "./region_projections/" # where to access the result files 
plot_filename <- "outputs.png"
IDPH_death_data_filename = "covidtracking_IDPH.csv" # Must include file with IDPH reported new deaths per day
intervention_scenarios <- c("100", "80", "60", "40")
hospital_capacity = 35031 # Total hospital beds in state
ICU_capacity = 3686
this_date <- "April 30, 2020" # Specify the last date of data used for inference
source("plot_intervention_comparisons.R")

```
