---
title: "Simulate from maximum likelihood parameter estimates"
author: Sylvia Ranjeva
date: May 1, 2020
output: html_document
---
Code to simulate interventions based on scaling of the post-intervention transmission rate beginning on a specified date at increases of 20, 40, and 60%. 

```{r}
require(dplyr)
require(pomp)
require(ggplot2)
require(magrittr)
require(lubridate)
require(MASS)
require(reshape2)
require(dplyr)
require(cowplot)
require(scales)


select <- dplyr::select
rename <- dplyr::rename
summarize <- dplyr::summarise
contains <- dplyr::contains

root <- '../../../'
source(file.path(root, '_covid_root.R'))

covid_set_root(root)

input_points_file =  #parameters file from the inference outputs folder 
source("input_file_specification.R")

# Projection specifications: all projections
reference_date <- as.Date("2020-01-14") # All numeric times in reference to this date 
end_projection_date <- as.Date("2020-09-29")
start_projection_date <- as.Date("2020-03-01")
deltaT = 0.1 # timestep for projections 

# Modify interventions from current values 
modify_interventions = F  #change interventions from default params for projections?
scalework = 0.6 # If changing interventions, specify here. 
scaleschool = 0 
scalehome = 1
scaleother = 0.5
frac_non_hosp = 0.21 # Fraction of deaths that occur outside of the hospital
time_lag_non_hosp_deaths = 10 # days from infection to non-hospitalized deaths
intervention_start_date <- as.Date("2020-03-16") 
intervention_end_date <- end_projection_date # For all scenarios, simulate assuming interventions in place indefinitely
scale_beta_start_date <- as.Date("2020-05-15")
regional_aggregation = T # do statewide estimates

## Scenario 1: no scaling on post-intervention beta
output_filename = "./sim_projections/projections_no_scaling"
beta_scaling = 1.0
t_start <- Sys.time()
source("inference_to_simulation_statewide.R")
t_end <- Sys.time()
print(t_end - t_start)

## Scenario 2: scale up 20% 
output_filename = "./sim_projections/projections_scale_20"
beta_scaling = 1.2
t_start <- Sys.time()
source("inference_to_simulation_statewide.R")
t_end <- Sys.time()
print(t_end - t_start)

## Scenario 2: scale up 40% 
output_filename = "./sim_projections/projections_scale_40"
beta_scaling = 1.4
t_start <- Sys.time()
source("inference_to_simulation_statewide.R")
t_end <- Sys.time()
print(t_end - t_start)

## Scenario 2: scale up 60% 
output_filename = "./sim_projections/projections_scale_60"
beta_scaling = 1.6
t_start <- Sys.time()
source("inference_to_simulation_statewide.R")
t_end <- Sys.time()
print(t_end - t_start)


## Plot results 
file_path = "./sim_projections_5/"
plot_filename <- "outputs.png"
intervention_scenarios <- c("no_scaling", "20", "40", "60")
this_date <- "April 30, 2020"
source("plot_intervention_comparisons.R")

```

