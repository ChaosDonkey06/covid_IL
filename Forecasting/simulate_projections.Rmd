---
title: "Simulate from maximum likelihood parameter estimates"
output: html_document
---
This code produces simulated projections of IL coronavirus dynamcis from the best-fit model parameters.  We simulate the dynamics under three different intervention scenarios:
1. Shelter in place beginning on March 16, 2020 and continuing indefinitely
2. Shelter in place beginning on March 16, and lifted on a determined date (here, May 1, 2020)
3. Shelter in place never enacted.

```{r}
require(dplyr)
require(pomp)
require(ggplot2)
require(magrittr)
require(lubridate)
require(MASS)
require(reshape2)
require(dplyr)
require(cowplot)
require(scales)


select <- dplyr::select
rename <- dplyr::rename
summarize <- dplyr::summarise
contains <- dplyr::contains

input_points_file = "../Inference/inference_outputs/model_params.csv"
source("input_file_specification.R")

# Projection specifications: all projections
reference_date <- as.Date("2020-01-14") # All numeric times in reference to this date 
end_projection_date <- as.Date("2020-07-31")
start_projection_date <- as.Date("2020-03-01")
deltaT = 0.1 # timestep for projections 

# Modify interventions from current values 
modify_interventions = F  #change interventions from default params for projections?
scalework = 0.6 # If changing interventions, specify here. 
scaleschool = 0 
scalehome = 1
scaleother = 0.5
frac_non_hosp = 0.21 # Fraction of deaths that occur outside of the hospital
time_lag_non_hosp_deaths = 10 # days from infection to non-hospitalized deaths

## Scenario 1: simulate assuming interventions in place indefinitely 
intervention_start_date <- as.Date("2020-03-16")
intervention_end_date <- end_projection_date
output_filename = "./sim_projections/projections_indefinite"

t_start <- Sys.time()
source("inference_to_simulation.R")
t_end <- Sys.time()
print(t_end - t_start)

## Scenario 2: simulate assuming that interventions were lifted 
intervention_start_date <- as.Date("2020-05-01")
intervention_end_date <- end_projection_date
output_filename = "./sim_projections/projections_lifted"

t_start <- Sys.time()
source("inference_to_simulation.R")
t_end <- Sys.time()
print(t_end - t_start)

## Scenario 3: simulate assuming that interventions had never occurred
intervention_start_date <- as.Date(end_projection_date + 1) # set a time after the end of simulations
intervention_end_date <- as.Date(end_projection_date + 2)
output_filename = "./sim_projections/projections_never"

t_start <- Sys.time()
source("inference_to_simulation.R")
t_end <- Sys.time()
print(t_end - t_start)


## Plot results ## ----------------------
file_path = "./sim_projections/"
plot_filename <- "outputs.png"
intervention_scenarios <- c("indefinite", "lifted", "never")

plot_filename <- "outputs.png"
intervention_scenarios <- c("indefinite", "lifted", "never")
this_date <- "April 22, 2020"

source("plot_intervention_comparisons.R")

```

